<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:pageModels="clr-namespace:Abilify.PageModels"
             xmlns:models="clr-namespace:Abilify.Models"
             xmlns:controls="clr-namespace:Abilify.Pages.Controls"
             xmlns:pullToRefresh="clr-namespace:Syncfusion.Maui.Toolkit.PullToRefresh;assembly=Syncfusion.Maui.Toolkit"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="Abilify.Pages.MainPage"
             x:DataType="pageModels:MainPageModel"
             Title="Welcome to Abilify">

    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior EventName="NavigatedTo" Command="{Binding NavigatedToCommand}" />
        <toolkit:EventToCommandBehavior EventName="NavigatedFrom" Command="{Binding NavigatedFromCommand}" />
        <toolkit:EventToCommandBehavior EventName="Appearing" Command="{Binding AppearingCommand}" />
    </ContentPage.Behaviors>

    <ContentPage.Resources>
        <ResourceDictionary>
            <toolkit:InvertedBoolConverter x:Key="InvertedBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <!-- ScrollView will wrap the whole content -->
    <ScrollView>
        <VerticalStackLayout Spacing="{StaticResource LayoutSpacing}" Padding="{StaticResource LayoutPadding}">

            <!-- Title section -->
            <VerticalStackLayout HorizontalOptions="Center" Spacing="5" Margin="0,20,0,10">
                <Label Text="{Binding TitleText}" Style="{StaticResource Headline}" />
                <BoxView HeightRequest="2" WidthRequest="160" BackgroundColor="{DynamicResource Primary}" HorizontalOptions="Center" CornerRadius="1" />
            </VerticalStackLayout>

            <!-- Microapps list -->
            <VerticalStackLayout BindableLayout.ItemsSource="{Binding Microapps}">
                <BindableLayout.ItemTemplate>
                    <DataTemplate x:DataType="models:MicroApp">
                        <Border Padding="15" Margin="0,0,0,10" BackgroundColor="{DynamicResource LightSecondaryBackground}" HorizontalOptions="Fill">
                            <VerticalStackLayout Spacing="10" HorizontalOptions="Center" VerticalOptions="Center">
                                <Label Text="{Binding Name}" FontSize="18" FontAttributes="Bold" HorizontalTextAlignment="Center" HorizontalOptions="Center" />
                                <!--<ImageButton Source="{Binding Icon}" Clicked="OnImageButtonClicked"  HorizontalOptions="Fill" VerticalOptions="Center"  CommandParameter="{Binding Route}" />-->
                                <Image Source="{Binding Icon}" HorizontalOptions="Fill" VerticalOptions="Center"/>
                                <Button Text="Open" Clicked="OnImageButtonClicked" HorizontalOptions="Fill" CommandParameter="{Binding Route}" />
                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </BindableLayout.ItemTemplate>
            </VerticalStackLayout>

            <!-- Toggle button -->
            <Button Text="{Binding ShowMoreText}" Command="{Binding ToggleShowAllToolsCommand}" BackgroundColor="Transparent" TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Primary}}" FontAttributes="Bold" FontSize="14" Padding="6" HorizontalOptions="Center" Margin="0,10,0,20" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
